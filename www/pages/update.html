<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: content: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <script src="components/loader.js"></script>
    <link rel="stylesheet" href="components/loader.css">
    <link rel="stylesheet" href="css/style.css">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-12 bg-info p-4 text-center">
          <h2 class="text-white">
            Cadastrar Aluno
          </h2>
        </div>
        <div class="col-12 mt-3 text-center">
          <a href="../index.html" class="text-info">Voltar</a>
        </div>
      </div>
      <div class="row">
        <div class="col-10 offset-1 mt-4">
          <form>
            <div class="form-group">
              <label for="nome">Nome</label>
              <input type="text" class="form-control form-control-lg" id="nome">
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" class="form-control form-control-lg" id="email">
            </div>
            <div class="form-group">
              <label for="senha">Senha</label>
              <input type="password" class="form-control form-control-lg" id="senha">
            </div>
            <button
              type="button"
              class="btn btn-info btn-lg btn-block p-3"
              id="atualizar"
            >
              Atualizar
            </button>
          </form>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    <script>
      function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = value;
        });
        return vars;
      }

      const varsUrl = getUrlVars();

      $(document).ready(() => {
        $.getJSON(`http://profrodolfo.com.br/webservice/index.php?listar=${varsUrl.id}`, (data) => {
          console.log(data[0].cd_aluno)
          $('#nome').val(data[0].nm_aluno);
          $('#email').val(data[0].ds_email);
          $('#senha').val(data[0].ds_senha);
        });
      });

      function limpar(){
        $('#nome').val('');
        $('#email').val('');
        $('#senha').val('');
      }

      $(document).on('click', '#atualizar', () => {
        var data = {
          "cd": varsUrl.id,
          "nome": $('#nome').val(),
          "email": $('#email').val(),
          "senha": $('#senha').val()
        };

        $.ajax({
          url: 'http://profrodolfo.com.br/webservice/index.php',
          data: data,
          type: 'post',
          success: (res) => {
            alert(res);
            limpar();
            window.location="../index.html";
          },
          error: (err) => {
            alert("Erro ao atualizar");
            limpar();
          },
        });
      });
    </script>
  </body>
</html>
